(()=>{var U=Object.defineProperty,T=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var I=(o,c,s)=>c in o?U(o,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[c]=s,l=(o,c)=>{for(var s in c||(c={}))E.call(c,s)&&I(o,s,c[s]);if(D)for(var s of D(c))q.call(c,s)&&I(o,s,c[s]);return o},u=(o,c)=>T(o,N(c));(function(){var O;let o=document.currentScript,c="dub_id",s="dub_partner_data",C=90*24*60*60*1e3,d=window.location.hostname,w=o.getAttribute("data-api-host")||"https://api.dub.co",A=(()=>{let i={domain:d==="localhost"?void 0:`.${d.replace(/^www\./,"")}`,path:"/",sameSite:"Lax",expires:new Date(Date.now()+C).toUTCString()},n=o.getAttribute("data-cookie-options");if(!n)return i;let e=JSON.parse(n);return e.expiresInDays&&(e.expires=new Date(Date.now()+e.expiresInDays*24*60*60*1e3).toUTCString(),delete e.expiresInDays),l(l({},i),e)})(),m=(()=>{let i=o.getAttribute("data-short-domain"),n=o.getAttribute("data-domains");if(n)try{let e=JSON.parse(n);return u(l({},e),{refer:e.refer||i})}catch(e){}return{refer:i}})(),p=m.refer,h=o.getAttribute("data-attribution-model")||"last-click",y=o.getAttribute("data-query-param")||"via",f=new URLSearchParams(location.search).get(y);if(window.DubAnalytics=window.DubAnalytics||{partner:null,discount:null},window.dubAnalytics){let e=function(r,...t){r==="ready"?e.ready(...t):r==="trackClick"?e.trackClick(...t):console.warn("[dubAnalytics] Unknown method:",r)};var P=e;let n=window.dubAnalytics.q||[];e.q=n,e.ready=function(r){r()},e.trackClick=function(...r){k(...r)},window.dubAnalytics=e}let a={get(i){var n;return(n=document.cookie.split(";").map(e=>e.trim().split("=")).find(([e])=>e===i))==null?void 0:n[1]},set(i,n){let e=Object.entries(A).filter(([,r])=>r).map(([r,t])=>`${r}=${t}`).join("; ");document.cookie=`${i}=${n}; ${e}`}},b={queue:((O=window.dubAnalytics)==null?void 0:O.q)||[],flush(i){let n=[];for(;this.queue.length;){let[e,...r]=this.queue.shift();!i||i(e)?this.process({method:e,args:r}):n.push([e,...r])}this.queue=n},process({method:i,args:n}){if(i==="ready"){let e=n[0];e()}else["trackClick"].includes(i)?k(...n):console.warn("[dubAnalytics] Unknown method:",i)}},g=!1;function k({domain:i,key:n}){if(g)return;g=!0;let r=new URLSearchParams(location.search).get(c);fetch(`${w}/track/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:i,key:n,url:window.location.href,referrer:document.referrer})}).then(t=>t.ok&&t.json()).then(t=>{if(t){if(r&&r!==t.clickId){console.warn(`[dubAnalytics] Client-tracked click ID ${t.clickId} does not match server-tracked click ID ${r}, skipping...`);return}if(a.set(c,t.clickId),t.partner){let _=u(l({},t),{partner:u(l({},t.partner),{name:encodeURIComponent(t.partner.name),image:t.partner.image?encodeURIComponent(t.partner.image):null})});a.set(s,JSON.stringify(_)),DubAnalytics.partner=t.partner,DubAnalytics.discount=t.discount,b.flush(R=>R==="ready")}return t}})}function S(){let i=new URLSearchParams(location.search),n=()=>!a.get(c)||h!=="first-click",e=i.get(c);e&&n()&&a.set(c,e),f&&p&&n()&&k({domain:p,key:f}),b.flush(t=>t==="trackClick");let r=a.get(s);if(r)try{let t=JSON.parse(r);DubAnalytics.partner=t.partner,DubAnalytics.discount=t.discount}catch(t){console.error("[dubAnalytics] Failed to parse partner cookie:",t)}}window._dubAnalytics={c:a,i:c,h:d,a:w,o:A,d:p,m:h,p:y,v:f,n:m},S()})();})();
